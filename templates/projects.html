<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Projects</title>
    <style>
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 8px; }
      th { background: #f2f2f2; }
      a.sort { text-decoration: none; font-size: 0.9em; margin-left: 6px; }
    </style>
  </head>
  <body>
    <h1>Projects – Portfolio Summary</h1>
    <p>
      <a href="{{ url_for('projects.export_projects', sort_by=request.args.get('sort_by'), order=request.args.get('order')) }}">Export CSV</a>
    </p>
    <table>
      <thead>
        <tr>
          <th>Project Name</th>
          <th>Owning Department</th>
          <th>
            Headcount
            {% for dir,label in [('asc','↑'),('desc','↓')] %}
              <a class="sort" href="?sort_by=headcount&order={{dir}}">{{label}}</a>
            {% endfor %}
          </th>
          <th>
            Total Hours
            {% for dir,label in [('asc','↑'),('desc','↓')] %}
              <a class="sort" href="?sort_by=total_hours&order={{dir}}">{{label}}</a>
            {% endfor %}
          </th>
        </tr>
      </thead>
      <tbody>
        {% for p in projects %}
        <tr>
          <td><a href="/projects/{{p.pnumber}}">{{p.project_name}}</a></td>
          <td>{{p.department_name or 'N/A'}}</td>
          <td style="text-align:right">{{p.headcount}}</td>
          <td style="text-align:right">{{p.total_hours}}</td>
          <!-- {% if g.user and g.user.get('role') == 'admin' %}
          <td>
            <a href="#">Edit</a> | <a href="#">Delete</a>
          </td>
          {% endif %} -->
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </body>
</html>
